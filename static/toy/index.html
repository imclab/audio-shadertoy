<!DOCTYPE html>
<html>
<head>
  <title>Audio-ShaderToy</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
  <link href="../css/toy.css" media="all" rel="stylesheet" type="text/css"/>
  <link href="../css/editor.css" media="all" rel="stylesheet" type="text/css"/>
  <script data-main="../src/toy-main.js" src="../lib/require.js"></script>
</head>
<body>
<canvas id="gl-canvas"></canvas>
<script id="src-vertex-default" type="x-shader/x-vertex">
attribute vec3 a_position;
attribute vec2 a_texcoord;

varying vec2 texcoord;

void main(){
  texcoord = a_texcoord;
  gl_Position = vec4(a_position, 1.);
}
</script>
<script id="src-fragment-default" type="x-shader/x-fragment">
// Audio ShaderToy

#define track http://soundcloud.com/chipdisko/usk-error-3003
#define smoothing .75
#define pixel_scale 2

vec3 pixel(vec2 pos) {
  float amp_l = ampLeft(pos.x);
  float amp_r = ampRight(1. - pos.x);

  // Draw Frequency Spectrum
  vec3 color = vec3(0.);
  color.r = float(amp_l > pos.y) * (pos.y / amp_l);
  color.b = float(amp_r > pos.y) * (pos.y / amp_r);
  color.g = (color.r + color.b) * .5;

  // Draw Progress
  vec2 p = (pos - vec2(1., 0.)) * vec2(-aspect, -1.) - vec2(.1, -.1);
  float r = length(p) / .05;
  float t = (atan(p.x, p.y) + PI) / (PI * 2.);
  if(r < 1.)
    return vec3(float(progress > t) * (t / progress) * r) + .07;

  return color;
}
</script>
<div id="ui-overlay" style="visibility:hidden;">
  <svg id="play-toggle" title="Toggle Track Play" width="60" height="60" version="1.2" xmlns="http://www.w3.org/2000/svg">
    <g transform="translate(30,30)">
      <circle cx="0" cy="0" r="28"/>
      <path class="play" d="M 10,0 L -8,-9 L -8,9 Z"/>
    </g>
  </svg>
</div>
<div id="save-scrim" class="shut"></div>
<div id="save-dialog" class="shut">
  <input id="save-dialog-link" class="dialog-textfield" type="text" size="36" autocomplete="off" spellcheck="false" readonly="readonly">
  <a id="save-dialog-save" class="dialog-button vcenter"><p>Share</p></a>
</div>
</body>
</html>
